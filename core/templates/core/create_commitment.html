{% extends 'core/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
    <h2>Add Commitment for {{ project.name }}</h2>

    <form class="flex-row" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <section id="input-fields" class="card stacked half-width">
            <span class="label-input">
                {{ form.commitment_type.label_tag }}
                {{ form.commitment_type }}
                {{ form.commitment_type.errors }}
            </span>

            <span class="label-input">
                {{ form.period.label_tag }}
                {{ form.period }}
                {{ form.period.errors }}
            </span>

            <span class="label-input">
                {{ form.target.label_tag }}
                {{ form.target }}
                <small class="help-text">{{ form.target.help_text }}</small>
                {{ form.target.errors }}
            </span>

            <hr>

            <h4>Time Banking Options</h4>

            <span class="label-input">
                <label for="{{ form.banking_enabled.id_for_label }}">
                    {{ form.banking_enabled }}
                    Enable Time Banking
                </label>
                <small class="help-text">Carry over surplus/deficit between periods</small>
                {{ form.banking_enabled.errors }}
            </span>

            <span class="label-input">
                {{ form.max_balance.label_tag }}
                {{ form.max_balance }}
                <small class="help-text">{{ form.max_balance.help_text }}</small>
                {{ form.max_balance.errors }}
            </span>

            <span class="label-input">
                {{ form.min_balance.label_tag }}
                {{ form.min_balance }}
                <small class="help-text">{{ form.min_balance.help_text }}</small>
                {{ form.min_balance.errors }}
            </span>

            {% if form.non_field_errors %}
                <div class="error-list">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <span>
                <button type="submit" class="primary-button">
                    <i class="fa fa-check-circle"></i>
                    Create Commitment
                </button>

                <button type="button" class="secondary-button"
                onclick="window.location.href = '{% url 'update_project' project.id %}' ">
                    <i class="fa fa-arrow-left"></i>
                    Cancel
                </button>
            </span>
        </section>

        <section id="help-info" class="card stacked half-width space-around">
            <h4><i class="fa fa-info-circle"></i> About Commitments</h4>
            <p>
                Commitments help you track whether you're meeting your goals for this project.
            </p>
            <p>
                <strong>Time-based:</strong> Set a target number of minutes per period.
            </p>
            <p>
                <strong>Session-based:</strong> Set a target number of sessions per period.
            </p>
            <p>
                <strong>Time Banking:</strong> When enabled, surplus time/sessions from one period
                carry over to the next. This helps balance busy and slow periods.
            </p>
        </section>
    </form>
{% endblock %}
