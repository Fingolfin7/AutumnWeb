{% extends 'core/base.html' %}
{% load static %}
{% load time_formats %}

{% block content %}
    <form class="flex-row" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <section class="card stacked half-width">
            <h2>Update Tag</h2>

            <div class="label-input">
                {{ form.name.label_tag }}
                {{ form.name }}
                {{ form.name.errors }}
            </div>

            <div class="label-input">
                {{ form.color.label_tag }}
                {{ form.color }}
                {{ form.color.errors }}
            </div>

            <div class="button-row">
                <button type="submit" class="primary-button">
                    <i class="fa fa-check-circle"></i>
                    Update Tag
                </button>
                <button type="button" class="primary-button dark-red" onclick="window.location.href='{% url 'delete_tag' tag.id %}'">
                    <i class="fa fa-trash"></i>
                    Delete Tag
                </button>
            </div>

            <div class="button-row">
                <button type="button" class="secondary-button" onclick="window.location.href='{% url 'tags' %}'">
                    <i class="fa fa-arrow-left"></i>
                    Back
                </button>
            </div>
        </section>

        <section class="card stacked half-width space-around">
            <h3>Tag Stats</h3>

            <div class="label-input">
                <label for="tag-context-select">Context</label>
                <select id="tag-context-select"
                        onchange="window.location.href='{% url 'update_tag' tag.id %}?context=' + encodeURIComponent(this.value)">
                    <option value="all" {% if not override_context_id or override_context_id == 'all' %}selected{% endif %}>All</option>
                    {% for ctx in user_contexts %}
                        <option value="{{ ctx.id }}" {% if override_context_id|stringformat:'s' == ctx.id|stringformat:'s' %}selected{% endif %}>
                            {{ ctx.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <span>
                Total projects:
                <span class="text-cyan">{{ sidebar_total_projects }}</span>
                {{ sidebar_status_counts|project_status_counts_formatter }}
            </span>

            <span>
                Total time:
                <span class="text-green">{{ sidebar_total_time|min_formatter }}</span>
            </span>

            <span>
                Average session length:
                <span class="text-cyan">{{ sidebar_average_session_duration|min_formatter }}</span>
            </span>
        </section>

    </form>
{% endblock %}
